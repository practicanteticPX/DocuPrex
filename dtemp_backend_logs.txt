  âœ… role_codes obtenidos (fallback): ["RESPONSABLE_CENTRO_COSTOS","RESPONSABLE_CUENTA_CONTABLE"]
ğŸ” [signatures resolver] Procesando signer: user_id=null, assigned_role_ids=[], role_names=["CausaciÃ³n"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["CAUSACION"]
ğŸ” [signatures] Usuario Juliet Acevedo: status=signed, role_names from DS=["Negociador"], role_name from DS=Negociador
ğŸ” [signatures] Usuario Negociaciones: status=pending, role_names from DS=["Negociaciones"], role_name from DS=Negociaciones
ğŸ” [signatures] Usuario Marcela Arango: status=pending, role_names from DS=["Resp Ctro Cost","Resp Cta Cont"], role_name from DS=Resp Ctro Cost
ğŸŒ Apollo Context: Authorization header: MISSING
âš ï¸ getUserFromToken: No token provided
âš ï¸ Apollo Context: Usuario no autenticado para esta request
ğŸ” Intentando autenticar usuario: negociaciones
ğŸ” Username length: 13
ğŸ” Username charCodes: [
  110, 101, 103, 111,  99,
  105,  97,  99, 105, 111,
  110, 101, 115
]
ğŸ” Intentando autenticar usuario: negociaciones
ğŸ”¤ Username bytes: <Buffer 6e 65 67 6f 63 69 61 63 69 6f 6e 65 73>
ğŸ” URL LDAP: ldap://192.168.0.253:389
ğŸ”‘ Intentando bind con cuenta de servicio: glpi.sync@prexxa.local
âœ“ Bind de servicio exitoso
ğŸ” Username original: "negociaciones"
ğŸ” Username escapado: "negociaciones"
ğŸ” Buscando usuario con filtro: (&(objectClass=user)(sAMAccountName=negociaciones))
ğŸ” Base de bÃºsqueda: DC=prexxa,DC=local
âœ“ Entrada encontrada: CN=Negociaciones,OU=Sabaneta,OU=Prexxa,DC=prexxa,DC=local
ğŸ“‹ Atributos del usuario: {
  "dn": "CN=Negociaciones,OU=Sabaneta,OU=Prexxa,DC=prexxa,DC=local",
  "cn": "Negociaciones",
  "displayName": "Negociaciones",
  "sAMAccountName": "negociaciones",
  "userPrincipalName": "negociaciones@prexxa.local",
  "mail": "negociaciones@prexxa.com.co"
}
ğŸ“Š Total de entradas encontradas: 1
âœ“ Usuario encontrado: Negociaciones
ğŸ” Verificando contraseÃ±a para DN original: CN=Negociaciones,OU=Sabaneta,OU=Prexxa,DC=prexxa,DC=local
ğŸ” DN decodificado: CN=Negociaciones,OU=Sabaneta,OU=Prexxa,DC=prexxa,DC=local
âœ“ ContraseÃ±a verificada correctamente con DN escapado
âœ“ ContraseÃ±a verificada para: negociaciones
âœ“ AutenticaciÃ³n exitosa: negociaciones
âœ“ Usuario existente autenticado desde AD: negociaciones
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸ” pendingDocuments para user 78 (undefined), grupos: []
ğŸ“‹ pendingDocuments encontrados: 1 [ { id: 145, title: 'FV - NEU ENERGY S.A.S. E.S.P. - 000072186' } ]
ğŸ” [signatures resolver] Procesando signer: user_id=45, assigned_role_ids=[], role_names=["Negociador"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["NEGOCIADOR"]
ğŸ” [signatures resolver] Procesando signer: user_id=78, assigned_role_ids=[], role_names=["Negociaciones"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["NEGOCIACIONES","RESPONSABLE_NEGOCIACIONES"]
ğŸ” [signatures resolver] Procesando signer: user_id=10, assigned_role_ids=[], role_names=["Resp Ctro Cost","Resp Cta Cont"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["RESPONSABLE_CENTRO_COSTOS","RESPONSABLE_CUENTA_CONTABLE"]
ğŸ” [signatures resolver] Procesando signer: user_id=null, assigned_role_ids=[], role_names=["CausaciÃ³n"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["CAUSACION"]
ğŸ” [signatures] Usuario Juliet Acevedo: status=signed, role_names from DS=["Negociador"], role_name from DS=Negociador
ğŸ” [signatures] Usuario Negociaciones: status=pending, role_names from DS=["Negociaciones"], role_name from DS=Negociaciones
ğŸ” [signatures] Usuario Marcela Arango: status=pending, role_names from DS=["Resp Ctro Cost","Resp Cta Cont"], role_name from DS=Resp Ctro Cost
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸ” Verificando cÃ©dula para: Carolina Martinez
ğŸ”¢ Ãšltimos 4 dÃ­gitos recibidos: 1234 Tipo: string
ğŸ‘¤ Usuario: undefined
ğŸ’³ CÃ©dula completa en BD: 1234
ğŸ”¢ Ãšltimos 4 en BD: 1234
ğŸ”¢ Ãšltimos 4 recibidos: 1234
âœ… Â¿Coinciden? true
âœ… VerificaciÃ³n exitosa
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
â­ï¸ Notificaciones desactivadas para el creador: e.zuluaga@prexxa.com.co
ğŸ“‹ Actualizando pÃ¡gina de firmantes para documento 145...
â­ï¸ Documento tipo FV: PÃ¡gina de firmantes se actualizarÃ¡ despuÃ©s del merge
âœ… Factura 24101 desmarcada de en_proceso
âœ… Factura 24101 desmarcada (documento rechazado)
ğŸ”„ Regenerando plantilla FV con marca de agua RECHAZADO para documento 145...
ğŸ“‹ Generando PDF de plantilla de factura (HTML â†’ PDF)...
ğŸ¢ Logo PT cargado para HTML (3 KB)
âœ… PDF de plantilla generado correctamente (pÃ¡gina grande)
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
âœ… Planilla PDF con marca RECHAZADO generada: /app/uploads/temp/planilla_rechazada_145_1766088378714.pdf
ğŸ“‹ Backups encontrados: [ 'uploads/originals/1766088295458_0_Invoice-1BE47DC5-0012.pdf' ]
ğŸ“‹ Campo original_pdf_backup: ["uploads/originals/1766088295458_0_Invoice-1BE47DC5-0012.pdf"]
ğŸ“‹ Archivos a fusionar (orden: planilla + backups): [
  '/app/uploads/temp/planilla_rechazada_145_1766088378714.pdf',
  '/app/uploads/originals/1766088295458_0_Invoice-1BE47DC5-0012.pdf'
]
ğŸ“„ Iniciando unificaciÃ³n de 2 PDFs...
  ğŸ“– Procesando archivo 1/2: planilla_rechazada_145_1766088378714.pdf
  âœ… 1 pÃ¡gina(s) agregadas
  ğŸ“– Procesando archivo 2/2: 1766088295458_0_Invoice-1BE47DC5-0012.pdf
  âœ… 1 pÃ¡gina(s) agregadas
âœ… PDF unificado creado exitosamente
  ğŸ“„ Total de pÃ¡ginas: 2
  ğŸ’¾ TamaÃ±o: 0.16 MB
  ğŸ“ Guardado en: /app/uploads/temp/merged_rejected_145_1766088378751.pdf
âœ… PDF base fusionado (planilla + backups) en temporal
ğŸ—‘ï¸  Archivo temporal eliminado: planilla_rechazada_145_1766088378714.pdf
ğŸ“‹ Agregando informe de firmantes al PDF fusionado...
ğŸ“„ Agregando pÃ¡gina de informaciÃ³n de firmantes a: merged_rejected_145_1766088378751.pdf
âœ… 2 pÃ¡gina(s) de firmantes agregada(s) exitosamente
âœ… Informe de firmantes agregado al PDF
âœ… Archivo del documento reemplazado correctamente
ğŸ—‘ï¸  Archivo temporal eliminado: merged_rejected_145_1766088378751.pdf
âœ… Factura 24101 desmarcada de en_proceso
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸ” pendingDocuments para user 78 (undefined), grupos: []
ğŸ“‹ pendingDocuments encontrados: 0 []
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸ” [signatures resolver] Procesando signer: user_id=45, assigned_role_ids=[], role_names=["Negociador"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["NEGOCIADOR"]
ğŸ” [signatures resolver] Procesando signer: user_id=78, assigned_role_ids=[], role_names=["Negociaciones"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["NEGOCIACIONES","RESPONSABLE_NEGOCIACIONES"]
ğŸ” [signatures resolver] Procesando signer: user_id=10, assigned_role_ids=[], role_names=["Resp Ctro Cost","Resp Cta Cont"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["RESPONSABLE_CENTRO_COSTOS","RESPONSABLE_CUENTA_CONTABLE"]
ğŸ” [signatures resolver] Procesando signer: user_id=null, assigned_role_ids=[], role_names=["CausaciÃ³n"]
  â¡ï¸ Fallback: usando role_names
  âœ… role_codes obtenidos (fallback): ["CAUSACION"]
ğŸ” [signatures] Usuario Juliet Acevedo: status=signed, role_names from DS=["Negociador"], role_name from DS=Negociador
ğŸ” [signatures] Usuario Negociaciones: status=rejected, role_names from DS=["Negociaciones"], role_name from DS=Negociaciones
ğŸ” [signatures] Usuario Marcela Arango: status=pending, role_names from DS=["Resp Ctro Cost","Resp Cta Cont"], role_name from DS=Resp Ctro Cost
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
ğŸŒ Apollo Context: Authorization header: Bearer eyJhbGciOiJIUzI1NiIsInR...
ğŸ”‘ getUserFromToken: Token recibido (primeros 20 chars): eyJhbGciOiJIUzI1NiIs...
âœ… getUserFromToken: Token vÃ¡lido para usuario: undefined
